<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Potsdam Transportation Company Bus Schedule Manager</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <link rel="stylesheet" type="text/css" href="style.css">
    
</head>
<body>
    <div class="container-fluid">
        <div class="row">
            <div class="col center-block text-center">
                <h1 id="title"><b>Potsdam Transportation Company Bus Schedule Manager</b></h1>
                <div id="explanation">
                    Operators: Press route icon associated with the bus that has arrived at the stop to record route delays.
                    Arrivals will be broadcast over headsets or shown at the bottom right.
                </div>
            </div>
        </div>
    </div>

    <div class="container-fluid">
        <div class="row">
            <div class="buttons">
                <div id="Massena" onclick="endTimer(this)"></div>
                <div id="Canton" onclick="endTimer(this)"></div>
                <div id="Ogdensburg" onclick="endTimer(this)"></div>
                <div id="Watertown" onclick="endTimer(this)"></div>
                <div id="Madrid" onclick="endTimer(this)"></div>
                <div id="Waddington" onclick="endTimer(this)"></div>
            </div>
        </div>
    </div>


    <div class="container-fluid">
        <div class="row">
            <div class="col col-8">
                <table id="arrival">
                    <tr>
                        <th>Click to start the test:</th>
                        <th><button onclick="startTimer()">Start</button></th>
                    </tr>
                    <tr>
                        <th>Current round:</th>
                        <th id="round-counter">~~</th>
                    </tr>
                    <tr>
                        <th>Total rounds:</th>
                        <th id="total-rounds">~~</th>
                    </tr>
                </table>
            </div>
            <div class="col">
                <div class="container-current-bus">
                    <h4 style="text-align: center;">Current bus at stop</h4>
                    <div class="current-bus" id="Massena"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        var startTime;
        var endTime;
        var elapsedTime;
        var rounds = 0;
        var maxRounds = 10;
        var done = false;
        var results = "";

        var routes = ["Massena", "Canton", "Ogdensburg", "Watertown", "Madrid", "Waddington"]

        var currentBusDiv = document.getElementsByClassName("current-bus")[0]
        var roundConter = document.getElementById("round-counter");
        var totalRoundCounter = document.getElementById("total-rounds");

        function startTimer() {
            startTime = Date.now();
            randomBus()
            this.roundConter.innerHTML = (rounds + 1);
        }

        function download(text, filename) {
            var blob = new Blob([text], {type: "text/plain"});
            var url = window.URL.createObjectURL(blob);
            var a = document.createElement("a");
            a.href = url;
            a.download = filename;
            a.click();
        }

        function endTimer(el) {
            if (!done) {
                endTime = Date.now();
                elapsedTime = endTime - startTime;

                if (el.id === currentBusDiv.id) {
                    console.log(elapsedTime + ", true");
                    results += (elapsedTime + ", true\n");
                } else {
                    console.log(elapsedTime + ", false");
                    results += (elapsedTime + ", false\n");
                }

                rounds++;
            }
            
            if (rounds < maxRounds) {
                startTimer()
            } else {
                done = true;
                alert("The test is complete. You will be prompted to download a text file containing the results.")
                download(results, "data.txt");
            }
            
            
        }

        function randomBus() {
            r = Math.floor(Math.random() * routes.length);
            newRoute = routes[r]
            this.currentBusDiv.id = newRoute
        }

        this.currentBusDiv.id = "NotStarted"
        this.totalRoundCounter.innerHTML = maxRounds;

        //randomBus()
        //startTimer()
    </script>

</body>
</html>